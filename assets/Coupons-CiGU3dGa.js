import{m as y}from"./modalMixins-Djpb7_wn.js";import{_,o as d,c as p,b as o,t as r,w as u,v as m,i as x,a as h,F as $,j as k,r as b}from"./index-Os4zg95r.js";import{D as w,P as D}from"./Pagination-j18QsHYH.js";import"./component-functions-Bmklu-WR.js";const L={props:["coupon"],data(){return{tempCoupon:{},due_date:""}},watch:{due_date(){this.tempCoupon.due_date=Math.floor(new Date(this.due_date)/1e3)},coupon(){this.tempCoupon=this.coupon;const s=new Date(this.tempCoupon.due_date*1e3).toISOString().split("T")[this.due_date]=s}},mixins:[y]},P={class:"modal fade",id:"couponModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},U={class:"modal-dialog",role:"document"},V={class:"modal-content"},N={class:"modal-header bg-primary text-light"},S={class:"modal-title",id:"exampleModalLabel"},T={class:"modal-body"},B={class:"mb-3"},F={class:"mb-3"},j={class:"mb-3"},A={class:"mb-3"},E={class:"mb-3"},I={class:"form-check"},O={class:"modal-footer"};function q(s,e,n,c,t,i){return d(),p("div",P,[o("div",U,[o("div",V,[o("div",N,[o("h5",S,[o("span",null,r(t.tempCoupon.id?"編輯優惠券":"新增優惠券"),1)]),e[6]||(e[6]=o("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),o("div",T,[o("div",B,[e[7]||(e[7]=o("label",{for:"title",class:"form-label"},"名稱",-1)),u(o("input",{type:"text",class:"form-control",id:"title",placeholder:"請輸入名稱","onUpdate:modelValue":e[0]||(e[0]=l=>t.tempCoupon.title=l)},null,512),[[m,t.tempCoupon.title]])]),o("div",F,[e[8]||(e[8]=o("label",{for:"coupon_code",class:"form-label"},"優惠碼",-1)),u(o("input",{type:"text",class:"form-control",id:"coupon_code",placeholder:"請輸入優惠碼","onUpdate:modelValue":e[1]||(e[1]=l=>t.tempCoupon.code=l)},null,512),[[m,t.tempCoupon.code]])]),o("div",j,[e[9]||(e[9]=o("label",{for:"due_date",class:"form-label"},"到期日",-1)),u(o("input",{type:"date",class:"form-control",id:"due_date","onUpdate:modelValue":e[2]||(e[2]=l=>t.due_date=l)},null,512),[[m,t.due_date]])]),o("div",A,[e[10]||(e[10]=o("label",{for:"price",class:"form-label"},"折扣百分比",-1)),u(o("input",{type:"number",class:"form-control",id:"price",placeholder:"請輸入折扣百分比","onUpdate:modelValue":e[3]||(e[3]=l=>t.tempCoupon.percent=l)},null,512),[[m,t.tempCoupon.percent]])]),o("div",E,[o("div",I,[u(o("input",{class:"form-check-input",type:"checkbox",id:"is_enabled","true-value":1,"false-value":0,"onUpdate:modelValue":e[4]||(e[4]=l=>t.tempCoupon.is_enabled=l)},null,512),[[x,t.tempCoupon.is_enabled]]),e[11]||(e[11]=o("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1))])])]),o("div",O,[e[12]||(e[12]=o("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1)),o("button",{type:"button",class:"btn btn-primary text-light",onClick:e[5]||(e[5]=l=>s.$emit("update-coupon",t.tempCoupon))}," 更新優惠券 ")])])])],512)}const z=_(L,[["render",q]]),G={data(){return{isLoading:!1,coupons:[],pagination:{},isNew:!1,tempCoupon:{}}},methods:{async deleteCoupon(s){const e=`https://vue3-course-api.hexschool.io/api/darrenapi/admin/coupon/${s.id}`;this.isLoading=!0;try{const n=await this.axios.delete(e);this.$httpMessageState(n,"刪除優惠券"),this.getCoupons()}catch(n){console.log(n)}finally{this.isLoading=!1,this.$refs.deleteModal.hideModal()}},openDeleteModal(s){this.tempCoupon={...s},this.$refs.deleteModal.showModal()},openModal(s,e){this.isNew=s,this.isNew?this.tempCoupon={is_enabled:1,due_date:new Date().getTime()/1e3}:this.tempCoupon={...e},this.$refs.couponMoal.showModal()},async getCoupons(s=1){const e=`https://vue3-course-api.hexschool.io/api/darrenapi/admin/coupons?page=${s}`;this.isLoading=!0;try{let n=await this.axios.get(e);this.coupons=n.data.coupons,this.pagination=n.data.pagination}catch(n){console.log(n)}finally{this.isLoading=!1}},async updateCoupon(s){const e=this.$refs.couponMoal;let n="https://vue3-course-api.hexschool.io/api/darrenapi/admin/coupon",c="post";this.isNew||(n=`https://vue3-course-api.hexschool.io/api/darrenapi/admin/coupon/${s.id}`,c="put"),this.isLoading=!0;try{let t=await this.axios[c](n,{data:s});this.$httpMessageState(t,"更新優惠券"),this.getCoupons()}catch(t){console.log(t)}finally{this.isLoading=!1,e.hideModal()}}},components:{CouponModal:z,DeleteModal:w,Pagination:D},created(){this.getCoupons()}},H={class:"text-end mt-4"},J={class:"table-responsive"},K={class:"table mt-4"},Q={class:"text-info"},R={key:0,class:"text-success"},W={key:1,class:"text-muted"},X={class:"btn-group"},Y=["onClick"],Z=["onClick"];function oo(s,e,n,c,t,i){const l=b("Loading"),f=b("CouponModal"),g=b("DeleteModal"),C=b("Pagination");return d(),p("div",null,[h(l,{active:t.isLoading},null,8,["active"]),e[2]||(e[2]=o("div",{class:"text-center mt-5 mb-5"},[o("h2",null,"優惠券")],-1)),o("div",H,[o("button",{class:"btn btn-primary text-light",onClick:e[0]||(e[0]=a=>i.openModal(!0))},"建立新的優惠券")]),o("div",J,[o("table",K,[e[1]||(e[1]=o("thead",null,[o("tr",null,[o("th",null,"名稱"),o("th",null,"優惠碼"),o("th",null,"折扣百分比"),o("th",null,"到期日"),o("th",null,"是否啟用"),o("th",null,"編輯")])],-1)),o("tbody",null,[(d(!0),p($,null,k(t.coupons,(a,v)=>(d(),p("tr",{key:"coupon"+v},[o("td",null,r(a.title),1),o("td",Q,r(a.code),1),o("td",null,r(a.percent)+"%",1),o("td",null,r(s.$filters.date(a.due_date)),1),o("td",null,[a.is_enabled?(d(),p("span",R,"啟用")):(d(),p("span",W,"未起用"))]),o("td",null,[o("div",X,[o("button",{class:"btn btn-outline-secondary btn-sm",onClick:M=>i.openModal(!1,a)}," 編輯 ",8,Y),o("button",{class:"btn btn-outline-danger btn-sm",onClick:M=>i.openDeleteModal(a)}," 刪除 ",8,Z)])])]))),128))])])]),h(f,{ref:"couponMoal",onUpdateCoupon:i.updateCoupon,coupon:t.tempCoupon},null,8,["onUpdateCoupon","coupon"]),h(g,{ref:"deleteModal",item:t.tempCoupon,onDeleteProduct:i.deleteCoupon},null,8,["item","onDeleteProduct"]),h(C,{pages:t.pagination,onChangePage:i.getCoupons},null,8,["pages","onChangePage"])])}const lo=_(G,[["render",oo]]);export{lo as default};
